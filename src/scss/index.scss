@use "attribution";
@use "font";
@use "style-settings";
@use "statblock-types" as statblocks;
@use "themes/default" as default;

/* 
Our Base for Statblocks Variables
*/

@each $block_name in statblocks.$names {
	.statblock.path2e#{$block_name} {
		// use the default theme
		@include default.theme;

		--statblock-primary-color: rgb(51, 51, 51);
		--statblock-rule-color: rgb(51, 51, 51);
		--statblock-background-color: rgb(246, 244, 242);
		--statblock-background-color-alt: rgb(229, 224, 219);
		/* Alternate Background Color */

		--statblock-bar-color: var(--statblock-rule-color);
		--statblock-bar-border-size: 1px;
		--statblock-bar-border-color: var(--statblock-rule-color);

		--statblock-image-width: 75px;
		--statblock-image-height: 75px;
		--statblock-image-border-size: 2px;
		--statblock-image-border-color: rgb(51, 51, 51);

		--statblock-border-size: 1px;
		--statblock-border-color: rgb(51, 51, 51);

		--statblock-box-shadow-color: rgb(255, 215, 0);
		--statblock-box-shadow-x-offset: 0;
		--statblock-box-shadow-y-offset: 0;
		--statblock-box-shadow-blur: 1.5em;

		--statblock-font-color: var(--statblock-primary-color);
		--statblock-font-weight: 400;

		--statblock-content-font: system-ui, "Pathfinder", -apple-system,
		BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
		"Open Sans", "Helvetica Neue", sans-serif;
		--statblock-content-font-size: 13px;

		--statblock-heading-font: system-ui, "Pathfinder", -apple-system,
		BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
		"Open Sans", "Helvetica Neue", sans-serif;
		--statblock-heading-font-color: var(--statblock-font-color);
		--statblock-heading-font-size: 1.35em;
		--statblock-heading-font-variant: small-caps;
		--statblock-heading-font-weight: 700;
		--statblock-heading-line-height: 1;

		--statblock-property-line-height: 1.33em;
		--statblock-property-font-color: var(--statblock-font-color);
		--statblock-property-name-font-color: var(--statblock-font-color);
		--statblock-property-name-font-weight: bold;

		--statblock-section-heading-border-size: 1px;
		--statblock-section-heading-border-color: transparent;
		--statblock-section-heading-font-color: var(--statblock-font-color);
		--statblock-section-heading-font-size: 1.33 empx;
		--statblock-section-heading-font-variant: small-caps;
		--statblock-section-heading-font-weight: 400;

		--statblock-saves-line-height: 1.33em;

		--statblock-spells-font-style: italic;


		--statblock-table-header-font-weight: bold;

		/* Done with Default Variables; now my additions */
		/* Font Text Catch-All */
		--statblock-other-font: system-ui, "Pathfinder", -apple-system,
		BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
		"Open Sans", "Helvetica Neue", sans-serif;
		--statblock-traits-font: system-ui, "Pathfinder", -apple-system,
		BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
		"Open Sans", "Helvetica Neue", sans-serif;
		--statblock-text-normal: rgb(--color-base-100);
		--statblock-text-muted: rgb(--color-base-50);
		--statblock-text-faint: rgba(--statblock-primary-color, 0.5);

		/* Hyperlinks need more help; cant see them. */
		--statblock-hyperlink-color: rgb(61, 102, 142);
		--statblock-hyperlink-text-decoration: rgb(51, 51, 51) underline solid;
		--statblock-hyperlink-text-shadow: 0.5px 0.5px 0.5px rgba(61, 102, 142);

		/* Italic can use a custom color. Don't like it? Change it! */
		--statblock-italic-font-color: rgb(77, 27, 105);

		/* H3, Redeclared. */
		--statblock-h3-variant: small-caps;
		--statblock-h3-letter-spacing: 1;
		--statblock-h3-line-height: 1.33em;
		--statblock-h3-size: 13px;
		--statblock-h3-color: rgb(51, 51, 51);
		--statblock-h3-weight: 400;
		--statblock-h3-font-style: normal;
		--statblock-h3-font-family: system-ui, "Pathfinder", -apple-system,
		BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
		"Open Sans", "Helvetica Neue", sans-serif;

		/* Column Width Control because... stuff */
		--statblock-column-width: 400px;
		--statblock-column2-width: 1000px;

		/* Traits General Control */
		--statblock-traits-box-sizing: border-box;
		--statblock-traits-font-color: rgb(255, 255, 255);
		--statblock-traits-letter-spacing: 0.01em;
		--statblock-traits-gap: 2px;
		--statblock-traits-margins: 0 var(--statblock-traits-gap) 0 0;
		--statblock-traits-min-width: 4em;
		--statblock-traits-padding: 0.4em 1.1em 0.2em;
		--statblock-traits-text-align: center;
		--statblock-traits-text-transform: uppercase;
		--statblock-traits-font-size: 12px;
		--statblock-traits-font-style: normal;
		--statblock-traits-font-weight: 900;

		/* UL/LI Control */
		--statblock-list-bullet-border: none;
		--statblock-list-bullet-radius: 50%;
		--statblock-list-bullet-size: 0.3em;
		--statblock-list-bullet-transform: none;
		--statblock-list-numbered-style: decimal;
		--statblock-list-indent: 2em;
		--statblock-list-margin-block-start: 1em;
		--statblock-list-margin-block-end: 1em;
		--statblock-list-margin-inline-start: 0px;
		--statblock-list-margin-inline-end: 0px;
		--statblock-list-marker-color: blue;
		--statblock-list-marker-color-collapsed: var(--text-accent);
		--statblock-list-marker-color-hover: var(--text-muted);
		--statblock-list-padding-inline-start: 40px;
		--statblock-list-padding-top: 0;
		--statblock-list-padding-bottom: 0;
		--statblock-list-spacing: 0.075em;
		--statblock-list-style-type: disc;
		--statblock-list-text-align: -webkit-match-parent;

		/* Name and Level Control */
		--statblock-upper-level-padding: 2em;
		--statblock-upper-level-margin: 2em;


		/* Default Functions Available within TTRPG Statblocks */

		/* Bar - Bai Bai Big Top Bar, Hello Tiny Top Bar */

		.bar {
			height: 1px;
			/* Default is 5px */
			background: var(--statblock-bar-color);
			border: var(--statblock-bar-border-size) solid var(--statblock-bar-border-color);
			z-index: 1;
			width: fit-content;
			/* Default is Auto */
		}

		/* Global Content */
		.statblock-content {
			font-family: var(--statblock-content-font);
			font-size: var(--statblock-content-font-size);
			color: var(--statblock-font-color);
			background-color: var(--statblock-background-color);
			padding: 0.5em;
			border: var(--statblock-border-size) var(--statblock-border-color) solid;
			box-shadow: var(--statblock-box-shadow-x-offset) var(--statblock-box-shadow-y-offset) var(--statblock-box-shadow-blur) var(--statblock-box-shadow-color);
			margin: 0.5em 2px;
			display: flex;
			gap: 1rem;


			.statblock-detached {
				position: absolute;
				top: -9999px;
			}

			.statblock-item-container {
				margin: 0;
				padding: 0;
			}

			.statblock-item-inline {
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				align-content: flex-start;
				align-items: baseline;
				justify-content: flex-start;
				margin: 0;
				padding: 0;
			}

			/* Spacing Fixes */

			/* Add margin to all root level containers and inline containers that have a line sub element, except if it is the title bar */
			& > .column {
				width: var(--statblock-column-width);

				& > :is(.statblock-item-container, .statblock-item-inline) {
					/* give everything with content, except the statblock heading, margin */
					&:has(.line, .property) {
						margin-block: 0.25rem;

						&:last-child {
							margin-bottom: 0;
						}
					}

					&:has(.line.name) {
						margin: 0;
					}

					/* Margins to get text indentation */
					& > :is(.property, .line:has(.property-name)) {
						margin-left: 1em;
					}

					& > :is(.property, .line) .property-name {
						margin-left: -1em;
					}
				}


				/* Add margin to all containers for tapered-rules */
				& > .statblock-item-container:has(.tapered-rule) {
					margin-block: 0.25rem;
				}

				/* Remove margin top from rule followin the title bar */
				& > .statblock-item-inline:has(.name) + .statblock-item-container:has(.tapered-rule) {
					margin-top: 0;
				}

				& > .statblock-item-inline:has(.rare_01,
					.rare_02,
					.rare_03,
					.rare_04,
					.alignment,
					.size,
					.xp,
					.kingdom_xp,
					.trait_01,
					.trait_02,
					.trait_03,
					.trait_04,
					.trait_05,
					.trait_06,
					.trait_07) {
					row-gap: var(--statblock-traits-gap);

					@if $block_name == "block" {
						margin-top: 0.5em;
					} @else {
						margin-bottom: 0.5em;
					}
				}

				/* Hazard Block Specific */
				@if $block_name == "blockhaz" {
					& > .statblock-item-container:has(.effect) {
						margin-left: 1em;
					}
				}
			}
		}

		@media screen and (max-width: 400px) {
			.statblock-content > :global(.column) {
				width: 75vw;
			}
		}

		/* Dice Roller Result */
		/* Can also be .dice-roller-result */

		.dice-roller-result {
			font-weight: var(--statblock-font-weight);
		}

		.roller-result {
			font-weight: var(--statblock-font-weight);
		}


		/* Image */

		.image {
			width: var(--statblock-image-width);
			height: var(--statblock-image-height);

			&.pointer {
				cursor: pointer;
			}

			img {
				object-fit: cover;
				width: 100%;
				height: 100%;
				border-radius: 100%;
				border: var(--statblock-image-border-size) solid var(--statblock-image-border-color);
				object-position: center;
			}
		}

		/* Line/Property Line */
		.line {
			line-height: var(--statblock-property-line-height);
			display: block;
			color: var(--statblock-property-line-font-color);
		}

		/* Make properties look consistent; readability */
		.statblock-rendered-text-content {
			color: var(--statblock-property-name-font-color);
			font-weight: var(--statblock-property-name-font-weight);
		}

		/* Targeted Line Heights */
		.statblock-markdown,
		.property {
			line-height: var(--statblock-property-line-height);
		}

		/* thin "hr" lines */
		div.tapered-rule {
			width: auto;
			margin: 0;
			height: 1px;
			background: var(--statblock-bar-color);
			clip-path: unset !important;
			-webkit-clip-path: unset;
		}

		/* Section Headings */
		.flex-container {
			align-items: center;
			display: flex;
			justify-content: space-between;
		}

		.heading {
			align-items: center;
			color: var(--statblock-heading-font-color);
			display: flex;
			font-family: var(--statblock-heading-font);
			font-variant: var(--statblock-heading-font-variant);
			font-weight: var(--statblock-heading-font-weight);
			justify-content: space-between;
			line-height: var(--statblock-heading-line-height);
			letter-spacing: 1px;
			margin: 0;
		}

		h1.section-header {
			border: none;
			color: var(--statblock-section-heading-font-color);
			font-size: var(--statblock-section-heading-font-size);
			font-variant: var(--statblock-section-heading-font-variant);
			font-weight: var(--statblock-section-heading-font-weight);
			letter-spacing: 1px;
			margin: 0;
			margin-bottom: 0.3em;
			break-inside: avoid-column;
			break-after: avoid-column;
		}

		h2.section-header {
			border: none;
			color: var(--statblock-section-heading-font-color);
			font-size: var(--statblock-section-heading-font-size);
			font-variant: var(--statblock-section-heading-font-variant);
			font-weight: var(--statblock-section-heading-font-weight);
			letter-spacing: 1px;
			margin: 0;
			margin-bottom: 0.3em;
			break-inside: avoid-column;
			break-after: avoid-column;
		}

		h3.section-header {
			border: none;
			color: var(--statblock-section-heading-font-color);
			font-size: var(--statblock-section-heading-font-size);
			font-variant: var(--statblock-section-heading-font-variant);
			font-weight: var(--statblock-section-heading-font-weight);
			letter-spacing: 1px;
			margin: 0;
			margin-bottom: 0;
			break-inside: avoid-column;
			break-after: avoid-column;
			display: none;
		}

		/* Spells per Layout */
		.spell-line .spells {
			font-style: var(--statblock-spells-font-style);
		}

		/* Tables */

		.statblock-table-header {
			font-weight: var(--statblock-table-header-font-weight);
		}

		.table {
			display: flex;
			justify-content: space-evenly;
			align-items: center;
			flex-wrap: wrap;
		}

		.table-item {
			display: flex;
			justify-content: center;
			align-items: center;
			flex-flow: column nowrap;
		}


		.traits {
			margin: 0 0.25em 0 0;
			display: inline;
			font-weight: var(--statblock-traits-font-weight) !important;
			font-style: var(--statblock-traits-font-style) !important;
		}


		/*

		General Fixes to make Statblock Look Uniform on MOST Themes.

		Theme Specific Fixes at the End. I cannot ccount for everything in a statblock at the getgo.

		*/

		/* View Section */

		/* Fix the TRAITS! BIGGGGG section */


		.rare_01 {
			background-color: var(--statblock-color-common) !important;
			/* common */
		}

		.rare_02 {
			background-color: var(--statblock-color-uncommon) !important;
			/* uncommon */
		}

		.rare_03 {
			background-color: var(--statblock-color-rare) !important;
			/* rare */
		}

		.rare_04 {
			background-color: var(--statblock-color-unique) !important;
			/* unique */
		}

		.alignment {
			background-color: var(--statblock-color-alignment) !important;
		}

		.size {
			background-color: var(--statblock-color-size) !important;
		}

		.xp,
		.kingdom_xp,
		.trait_01,
		.trait_02,
		.trait_03,
		.trait_04,
		.trait_05,
		.trait_06,
		.trait_07 {
			background-color: var(--statblock-color-trait) !important;
		}

		.rare_01,
		.rare_02,
		.rare_03,
		.rare_04,
		.alignment,
		.size,
		.xp,
		.kingdom_xp,
		.trait_01,
		.trait_02,
		.trait_03,
		.trait_04,
		.trait_05,
		.trait_06,
		.trait_07 {
			color: var(--statblock-traits-font-color) !important;
			font-size: var(--statblock-traits-font-size);
			font-style: var(--statblock-traits-font-style) !important;
			font-weight: var(--statblock-traits-font-weight) !important;
			letter-spacing: var(--statblock-traits-letter-spacing);
			min-width: var(--statblock-traits-min-width);
			margin: var(--statblock-traits-margins);
			padding: var(--statblock-traits-padding);
			text-align: var(--statblock-traits-text-align);
			text-transform: var(--statblock-traits-text-transform);

			span.property-name {
				display: none;
			}
		}


		/* Prevents an empty section header from generating a border */

		/* Font Fixes for H3 in Pf2e and prevents other themes from butting in. */
		h3,
		.markdown-rendered h3,
		.HyperMD-header-3,
		.inline-title[data-level="3"],
		.HyperMD-list-line .cm-header-3 {
			font-variant: var(--statblock-h3-variant);
			letter-spacing: var(--statblock-h3-letter-spacing);
			line-height: var(--statblock-h3-line-height);
			font-size: var(--statblock-h3-size);
			color: var(--statblock-h3-color);
		}

		/* Help the Hyperlinks! */
		a,
		a:-webkit-any-link,
		a.internal-link {
			color: var(--statblock-hyperlink-color);
			font-weight: bolder;
			text-decoration: var(--statblock-hyperlink-text-decoration);
		}

		/* Almost forgot the bold ones! */
		b,
		strong,
		.cm-strong {
			font-weight: var(--statblock-property-name-font-weight);
			color: var(--statblock-property-name-font-color);
		}

		/* Fixing Em to be a bit more... there. */
		i,
		em,
		.cm-em {
			font-style: italic;
			color: var(--statblock-italic-font-color);
			font-weight: 500;
		}

		/*
		Now for Specific Fixes!
		*/

		/* Formatting of the statblock heading */
		.statblock-item-inline:has(.statblock-inline-item .name) {
			display: flex;
			flex-direction: row;
			margin-inline: 0.25em;
			gap: 0.25em;

			.statblock-inline-item {
				&:has(.name) {
					flex: 1;
				}

				.name,
				.level {
					/* Always Confirm that the Name and Level Properties have these functions, despite p */
					p {
						align-self: flex-start;
						font-size: 1.2em;
						font-weight: 900;
						text-transform: uppercase;
					}

					/* Hide the property names in the title bar bc they add extra spacing. Per Layout. */
					span.property-name {
						display: none;
					}
				}

				/* Unbinding Images */
				.image {
					width: unset;
					height: unset;
				}

				/* Image Border Too. */
				img {
					width: unset;
					height: var(--statblock-property-line-height);
					border-radius: 0;
					border: none;
				}
			}
		}

		/* Corrects the UL/LI Coloration */
		ul {
			display: block;
			list-style-type: var(--statblock-list-style-type);
			margin-block-start: var(--statblock-list-margin-block-start);
			margin-block-end: var(--statblock-list-margin-block-end);
			margin-inline-start: var(--statblock-list-margin-inline-start);
			margin-inline-end: var(--statblock-list-margin-inline-end);
			padding-inline-start: var(--statblock-list-padding-inline-start);
		}

		.markdown-rendered ul,
		.markdown-rendered ol {
			padding-inline-start: var(--statblock-list-indent);
		}

		li {
			color: var(--statblock-content-font);
			display: list-item;
			text-align: var(--statblock-list-text-align);
		}

		.markdown-source-view ol > li,
		.markdown-source-view ul > li,
		.markdown-preview-view ol > li,
		.markdown-preview-view ul > li,
		.markdown-rendered ul > li,
		.mod-cm6 .HyperMD-list-line.cm-line {
			padding-top: var(--statblock-list-padding-top);
			padding-bottom: var(--statblock-list-padding-bottom);
		}

		ol > li::marker,
		ul > li::marker,
		.cm-s-obsidian .cm-formatting-list {
			color: var(--list-marker-color);
		}

		::marker {
			unicode-bidi: isolate;
			font-variant-numeric: tabular-nums;
			text-transform: none;
			text-indent: 0;
			text-align: start;
			text-align-last: start;
		}
	}
}
